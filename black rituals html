<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>Illuminati Black Rituals - Premium Spiritual Products</title>
    <link rel="icon" href="https://i.postimg.cc/rwmPjzWr/IMG-2949.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=Ady7oSqLjAlGYqeeGGp2DC2iaw0_VlpT-UalhX8mviFylCUQn1I4jPKNqKNvG2QueVnzaK0j3UyvXPzU&currency=USD"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href__="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body { 
            margin: 0; 
            padding: 0; 
            background: #ffffff;
            color: #000000;
        }
        
        .hidden { display: none !important; }
        
        .product-card { 
            background: #ffffff;
            border-radius: 20px; 
            overflow: hidden; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e5e7eb;
            cursor: pointer;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            border-color: #d4af37;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #d4af37 0%, #aa8b2e 100%); 
            color: #000; 
            padding: 14px 28px; 
            border: none; 
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            text-transform: uppercase; 
            letter-spacing: 1.2px;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.25);
            font-size: 13px;
        }
        
        .btn-primary:hover { 
            background: linear-gradient(135deg, #aa8b2e 0%, #8b7424 100%); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4); 
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #1f2937;
            padding: 12px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
            border-color: #d4af37;
        }
        
        .input-field { 
            width: 100%; 
            padding: 14px 18px; 
            background: #f9fafb; 
            border: 2px solid #e5e7eb; 
            border-radius: 12px; 
            font-size: 15px; 
            transition: all 0.3s; 
            color: #000;
        }
        
        .input-field:focus { 
            outline: none; 
            border-color: #d4af37; 
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1); 
            background: #ffffff;
        }
        
        textarea.input-field { 
            min-height: 120px; 
            resize: vertical; 
        }
        
        .tab-button { 
            padding: 12px 24px; 
            background: #f9fafb; 
            border: 2px solid #e5e7eb; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.3s; 
            margin-right: 10px; 
            font-weight: 600;
            color: #4b5563;
        }
        
        .tab-button.active { 
            background: linear-gradient(135deg, #d4af37 0%, #aa8b2e 100%);
            color: #000;
            border-color: #d4af37;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: linear-gradient(135deg, #d4af37 0%, #aa8b2e 100%);
            color: #000;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
            z-index: 9999;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
        }
        
        .toast.error { 
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: #fff;
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }
        
        @keyframes slideIn {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s;
            overflow-y: auto;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: #ffffff;
            border: 2px solid #d4af37;
            border-radius: 24px;
            max-width: 1000px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .stat-card {
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card:hover {
            border-color: #d4af37;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(212, 175, 55, 0.15);
        }
        
        .price-tag {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 14px;
            background: #fef3c7;
            border: 1px solid #d4af37;
            color: #92400e;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .alert-box {
            background: #fef3c7;
            border: 2px solid #d4af37;
            border-radius: 12px;
            padding: 12px 16px;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-box i {
            color: #92400e;
        }
        
        .alert-box p {
            color: #92400e;
            font-size: 13px;
            font-weight: 600;
            margin: 0;
        }
        
        .image-gallery {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 0;
        }
        
        .image-gallery img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .image-gallery img:hover {
            border-color: #d4af37;
            transform: scale(1.1);
        }
        
        .order-card {
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }
        
        .order-card:hover {
            border-color: #d4af37;
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.15);
        }
        
        .order-card.completed {
            background: #f0fdf4;
            border-color: #86efac;
        }
        
        #paypal-button-container {
            margin-top: 20px;
        }
        
        .ritual-option {
            background: #fff;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .ritual-option:hover {
            border-color: #d4af37;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(212, 175, 55, 0.2);
        }
        
        .ritual-option.selected {
            border-color: #d4af37;
            background: #fef3c7;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 8px;
            max-width: 70%;
            word-wrap: break-word;
        }

        .message-bubble.sent {
            background: linear-gradient(135deg, #d4af37 0%, #aa8b2e 100%);
            color: #000;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message-bubble.received {
            background: #f3f4f6;
            color: #000;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #aa8b2e;
        }
    </style>
</head>

<body>
    <div id="app-container">
        <!-- Admin Panel -->
        <div id="admin-page" class="hidden min-h-screen p-6 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="flex justify-between items-center mb-10">
                    <div>
                        <h1 class="text-5xl font-black text-gray-900 mb-2">Admin Dashboard</h1>
                        <p class="text-gray-600 text-lg">Manage Illuminati Black Rituals Store</p>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="showPage('messages')" class="btn-secondary">
                            <i data-lucide="message-circle" class="w-5 h-5 inline mr-2"></i>Messages
                        </button>
                        <button onclick="showPage('home')" class="btn-primary">
                            <i data-lucide="home" class="w-5 h-5 inline mr-2"></i>Back to Store
                        </button>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                    <div class="stat-card">
                        <div class="flex items-center justify-between mb-4">
                            <i data-lucide="shopping-bag" class="w-10 h-10 text-yellow-600"></i>
                            <span class="text-sm text-gray-500">Total</span>
                        </div>
                        <div class="text-4xl font-black text-gray-900 mb-1" id="stat-products">0</div>
                        <div class="text-gray-600 text-sm font-semibold">Products</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="flex items-center justify-between mb-4">
                            <i data-lucide="users" class="w-10 h-10 text-yellow-600"></i>
                            <span class="text-sm text-gray-500">Total</span>
                        </div>
                        <div class="text-4xl font-black text-gray-900 mb-1" id="stat-customers">0</div>
                        <div class="text-gray-600 text-sm font-semibold">Customers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="flex items-center justify-between mb-4">
                            <i data-lucide="package" class="w-10 h-10 text-yellow-600"></i>
                            <span class="text-sm text-gray-500">All Time</span>
                        </div>
                        <div class="text-4xl font-black text-gray-900 mb-1" id="stat-orders">0</div>
                        <div class="text-gray-600 text-sm font-semibold">Orders</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="flex items-center justify-between mb-4">
                            <i data-lucide="dollar-sign" class="w-10 h-10 text-yellow-600"></i>
                            <span class="text-sm text-gray-500">Total Revenue</span>
                        </div>
                        <div class="text-4xl font-black text-gray-900 mb-1" id="stat-revenue">R0</div>
                        <div class="text-gray-600 text-sm font-semibold">Revenue</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid md:grid-cols-2 gap-6 mb-10">
                    <div class="stat-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Orders Over Time</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Product Categories</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Admin Tabs -->
                <div class="mb-8">
                    <div class="flex flex-wrap gap-4">
                        <button onclick="showAdminTab('products')" id="admin-tab-products" class="tab-button active">
                            <i data-lucide="shopping-bag" class="w-5 h-5 inline mr-2"></i>Manage Products
                        </button>
                        <button onclick="showAdminTab('orders')" id="admin-tab-orders" class="tab-button">
                            <i data-lucide="clipboard-list" class="w-5 h-5 inline mr-2"></i>Orders
                        </button>
                        <button onclick="showAdminTab('testimonials')" id="admin-tab-testimonials" class="tab-button">
                            <i data-lucide="message-square" class="w-5 h-5 inline mr-2"></i>Testimonials
                        </button>
                        <button onclick="showAdminTab('settings')" id="admin-tab-settings" class="tab-button">
                            <i data-lucide="settings" class="w-5 h-5 inline mr-2"></i>Settings
                        </button>
                    </div>
                </div>

                <!-- Products Tab -->
                <div id="admin-content-products" class="admin-content">
                    <div class="stat-card p-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-8 flex items-center gap-4">
                            <i data-lucide="plus-circle" class="w-8 h-8 text-yellow-600"></i>
                            Add New Product
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <div class="space-y-5">
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Product Name *</label>
                                    <input id="new-product-name" placeholder="e.g., Black Sage Bundle" class="input-field">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Price (ZAR) *</label>
                                    <input id="new-product-price" type="number" placeholder="e.g., 6500" class="input-field">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Category *</label>
                                    <select id="new-product-category" class="input-field">
                                        <option value="herbs">Sacred Herbs</option>
                                        <option value="crystals">Crystals & Stones</option>
                                        <option value="rituals">Ritual Kits</option>
                                        <option value="oils">Essential Oils</option>
                                        <option value="candles">Ritual Candles</option>
                                        <option value="protection">Protection Items</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Upload Product Images *</label>
                                    <input id="new-product-images" type="file" multiple accept="image/*" class="input-field">
                                    <p class="text-xs text-gray-500 mt-2">You can select multiple images</p>
                                    <div id="image-preview" class="mt-4 flex gap-2 flex-wrap"></div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Contact Phone *</label>
                                    <input id="new-product-phone" placeholder="+27 XX XXX XXXX" class="input-field">
                                </div>
                            </div>
                            
                            <div class="space-y-5">
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Short Description *</label>
                                    <textarea id="new-product-description" placeholder="Brief description..." class="input-field" rows="3"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Full Details *</label>
                                    <textarea id="new-product-details" placeholder="Detailed information about benefits, origin, energy properties..." class="input-field" rows="6"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Usage Instructions *</label>
                                    <textarea id="new-product-instructions" placeholder="Step by step instructions..." class="input-field" rows="6"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addProduct()" id="add-product-btn" class="btn-primary w-full text-lg py-5">
                            <i data-lucide="plus" class="w-6 h-6 inline mr-2"></i>Add Product to Store
                        </button>
                        
                        <div class="mt-12">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">All Products</h3>
                            <div id="admin-products-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                        </div>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div id="admin-content-orders" class="admin-content hidden">
                    <div class="stat-card p-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-8">Order Management</h2>
                        <div id="orders-list"></div>
                    </div>
                </div>

                <!-- Testimonials Tab -->
                <div id="admin-content-testimonials" class="admin-content hidden">
                    <div class="stat-card p-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-8">Manage Testimonials</h2>
                        
                        <div class="grid md:grid-cols-2 gap-8 mb-8">
                            <div class="space-y-5">
                                <h3 class="text-xl font-bold text-yellow-600">Add New Testimonial</h3>
                                <input id="new-testimonial-name" placeholder="Customer Name" class="input-field">
                                <input id="new-testimonial-title" placeholder="e.g., Energy Healer" class="input-field">
                                <textarea id="new-testimonial-quote" placeholder="Testimonial text..." class="input-field" rows="4"></textarea>
                                <input id="new-testimonial-image" type="file" accept="image/*" class="input-field">
                                <button onclick="addTestimonial()" class="btn-primary w-full">
                                    <i data-lucide="plus-circle" class="w-5 h-5 inline mr-2"></i>Add Testimonial
                                </button>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-yellow-600 mb-4">Current Testimonials</h3>
                                <div id="testimonials-admin-list" class="space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="admin-content-settings" class="admin-content hidden">
                    <div class="stat-card p-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-8">Store Settings</h2>
                        <div class="space-y-6 max-w-2xl">
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Store Email</label>
                                <input id="shop-email" type="email" value="illuminatiblackrituals@gmail.com" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Contact Phone</label>
                                <input id="shop-phone" value="27810792898" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Footer Text</label>
                                <input id="footer-text" value="© 2024 Illuminati Black Rituals - Premium Spiritual Products" class="input-field">
                            </div>
                            <button onclick="saveSettings()" class="btn-primary w-full">
                                <i data-lucide="save" class="w-5 h-5 inline mr-2"></i>Save All Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages Page -->
        <div id="messages-page" class="hidden min-h-screen p-6 bg-gray-50">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-10">
                    <div>
                        <h1 class="text-5xl font-black text-gray-900 mb-2">Customer Messages</h1>
                        <p class="text-gray-600 text-lg">View and respond to customer inquiries</p>
                    </div>
                    <button onclick="showPage('admin')" class="btn-primary">
                        <i data-lucide="arrow-left" class="w-5 h-5 inline mr-2"></i>Back to Admin
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Conversations List -->
                    <div class="stat-card p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Conversations</h3>
                        <div id="conversations-list" class="space-y-3"></div>
                    </div>

                    <!-- Chat Area -->
                    <div class="md:col-span-2 stat-card p-6">
                        <div id="no-chat-selected" class="text-center py-20">
                            <i data-lucide="message-circle" class="w-20 h-20 text-gray-300 mx-auto mb-4"></i>
                            <p class="text-gray-500 text-lg">Select a conversation to view messages</p>
                        </div>

                        <div id="chat-area" class="hidden">
                            <div class="mb-6 pb-4 border-b-2 border-gray-200">
                                <h3 class="text-xl font-bold text-gray-900" id="chat-customer-name">Customer</h3>
                                <p class="text-sm text-gray-600" id="chat-customer-email"></p>
                            </div>

                            <div id="messages-container" class="h-96 overflow-y-auto mb-6 space-y-3"></div>

                            <div class="flex gap-3">
                                <input id="admin-message-input" placeholder="Type your response..." class="input-field" onkeypress="if(event.key==='Enter') sendAdminMessage()">
                                <button onclick="sendAdminMessage()" class="btn-primary px-6">
                                    <i data-lucide="send" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Home / Shop Page -->
        <div id="home-page">
            <!-- Navigation Header -->
            <header class="sticky top-0 z-50 bg-white shadow-md">
                <div class="container mx-auto px-6 py-5">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <img src="https://i.postimg.cc/rwmPjzWr/IMG-2949.png" 
                                 alt="Logo" class="w-14 h-14 object-contain">
                            <div>
                                <h1 class="text-2xl md:text-3xl font-black text-gray-900">ILLUMINATI BLACK RITUALS</h1>
                                <p class="text-xs text-gray-600 tracking-wider uppercase">Premium Spiritual Products</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button onclick="openContactModal()" class="btn-secondary px-6 py-3">
                                <i data-lucide="message-circle" class="w-5 h-5 inline mr-2"></i>Message Us
                            </button>
                            <button onclick="showAdminLogin()" class="btn-secondary px-6 py-3">
                                <i data-lucide="user" class="w-5 h-5 inline mr-2"></i>Admin
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Hero Section -->
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 py-20">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-5xl md:text-6xl font-black text-gray-900 mb-6 leading-tight">
                        Ancient Wisdom<br/>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-yellow-500">Modern Power</span>
                    </h2>
                    <p class="text-xl text-gray-700 max-w-3xl mx-auto mb-10 leading-relaxed">
                        Discover our exclusive collection of sacred herbs, powerful crystals, and mystical ritual kits. 
                        Each product is carefully selected and energetically charged for maximum spiritual potency.
                    </p>
                    <div class="flex flex-wrap justify-center gap-8">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center shadow-lg">
                                <i data-lucide="shield-check" class="w-7 h-7 text-white"></i>
                            </div>
                            <div class="text-left">
                                <div class="font-bold text-gray-900">100% Authentic</div>
                                <div class="text-gray-600 text-sm">Ethically Sourced</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center shadow-lg">
                                <i data-lucide="zap" class="w-7 h-7 text-white"></i>
                            </div>
                            <div class="text-left">
                                <div class="font-bold text-gray-900">Energetically Charged</div>
                                <div class="text-gray-600 text-sm">Moon-Blessed</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center shadow-lg">
                                <i data-lucide="lock" class="w-7 h-7 text-white"></i>
                            </div>
                            <div class="text-left">
                                <div class="font-bold text-gray-900">Secure Checkout</div>
                                <div class="text-gray-600 text-sm">PayPal Protected</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div class="py-20 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-5xl font-black text-gray-900 mb-4">Our Sacred Collection</h2>
                        <p class="text-gray-600 text-lg">Click any product to view full details and purchase</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="products-grid"></div>
                </div>
            </div>

            <!-- Registration & Ritual Payments -->
            <div class="py-20 bg-gray-50">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-5xl font-black text-gray-900 mb-4">Registration & Ritual Payments</h2>
                        <p class="text-gray-600 text-lg">Become a full member or pay for your custom ritual</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <div class="stat-card p-10 text-center cursor-pointer hover:shadow-2xl transition" onclick="openRegistrationModal()">
                            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="user-plus" class="w-10 h-10 text-white"></i>
                            </div>
                            <h3 class="text-2xl font-black text-gray-900 mb-4">Member Registration</h3>
                            <p class="text-gray-600 mb-6">Join our exclusive community and unlock full access to our spiritual services</p>
                            <div class="price-tag">Custom Amount</div>
                            <button onclick="openRegistrationModal()" class="btn-primary w-full mt-6">
                                <i data-lucide="credit-card" class="w-5 h-5 inline mr-2"></i>Pay Registration Fee
                            </button>
                        </div>
                        
                        <div class="stat-card p-10 text-center cursor-pointer hover:shadow-2xl transition" onclick="openRitualPaymentModal()">
                            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="flame" class="w-10 h-10 text-white"></i>
                            </div>
                            <h3 class="text-2xl font-black text-gray-900 mb-4">Ritual Payment</h3>
                            <p class="text-gray-600 mb-6">Select your ritual and make payment to begin your spiritual journey</p>
                            <div class="price-tag">Select Ritual</div>
                            <button onclick="openRitualPaymentModal()" class="btn-primary w-full mt-6">
                                <i data-lucide="sparkles" class="w-5 h-5 inline mr-2"></i>Choose & Pay for Ritual
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testimonials Section -->
            <div class="py-20 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-5xl font-black text-gray-900 mb-4">Customer Experiences</h2>
                        <p class="text-gray-600 text-lg">Real stories from our spiritual community</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="testimonials-grid"></div>
                </div>
            </div>

            <!-- Protection Section -->
            <div class="py-20 bg-gray-50">
                <div class="container mx-auto px-6">
                    <div class="max-w-4xl mx-auto stat-card p-12 text-center">
                        <i data-lucide="shield" class="w-20 h-20 text-yellow-600 mx-auto mb-6"></i>
                        <h3 class="text-4xl font-black text-gray-900 mb-6">Spiritual Protection Guarantee</h3>
                        <p class="text-gray-700 leading-relaxed text-lg mb-6">
                            Every product in our collection is ethically sourced, energetically cleansed, and blessed under the full moon. 
                            We protect your spiritual journey with ancient wards and modern security. Your privacy is sacred to us.
                        </p>
                        <p class="text-gray-600 text-sm">
                            All transactions are secured through PayPal's encrypted payment gateway. 
                            Your personal information is protected with bank-level security.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="bg-gray-900 text-white py-12">
                <div class="container mx-auto px-6">
                    <div class="grid md:grid-cols-3 gap-12 mb-8">
                        <div>
                            <h4 class="text-xl font-black mb-4">ILLUMINATI BLACK RITUALS</h4>
                            <p class="text-gray-400 text-sm leading-relaxed">
                                Your trusted source for authentic spiritual products. 
                                Serving the community with integrity and power.
                            </p>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold mb-4">Contact Us</h4>
                            <div class="space-y-3 text-gray-400 text-sm">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="mail" class="w-5 h-5 text-yellow-500"></i>
                                    <span id="footer-email">illuminatiblackrituals@gmail.com</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <i data-lucide="phone" class="w-5 h-5 text-yellow-500"></i>
                                    <span id="footer-phone">27810792898</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <i data-lucide="map-pin" class="w-5 h-5 text-yellow-500"></i>
                                    <span>Gauteng, Randburg, George AVE Street</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold mb-4">Quick Links</h4>
                            <div class="space-y-2 text-gray-400 text-sm">
                                <div class="hover:text-yellow-500 cursor-pointer transition">About Us</div>
                                <div class="hover:text-yellow-500 cursor-pointer transition">Shipping Info</div>
                                <div class="hover:text-yellow-500 cursor-pointer transition">Privacy Policy</div>
                                <div class="hover:text-yellow-500 cursor-pointer transition">Terms & Conditions</div>
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-gray-800 pt-8 text-center">
                        <p id="footer-copyright" class="text-gray-500 text-sm">© 2024 Illuminati Black Rituals - Premium Spiritual Products</p>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Product Detail Modal -->
        <div id="product-modal" class="modal hidden" onclick="if(event.target === this) closeProductModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div id="product-modal-content"></div>
            </div>
        </div>

        <!-- PayPal Checkout Modal -->
        <div id="paypal-modal" class="modal hidden" onclick="if(event.target === this) closePayPalModal()">
            <div class="bg-white rounded-2xl p-10 max-w-2xl w-full mx-4 shadow-2xl max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-gray-900">Secure Checkout</h2>
                    <button onclick="closePayPalModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </div>
                
                <div id="paypal-order-summary" class="mb-8"></div>
                
                <div class="space-y-6 mb-8">
                    <h3 class="text-xl font-bold text-gray-900">Your Information</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Full Name *</label>
                            <input id="paypal-name" required placeholder="Your full name" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Email *</label>
                            <input id="paypal-email" type="email" required placeholder="your@email.com" class="input-field">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Phone Number *</label>
                            <input id="paypal-phone" required placeholder="+27 XX XXX XXXX" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">City *</label>
                            <input id="paypal-city" required placeholder="City name" class="input-field">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Delivery Address *</label>
                        <textarea id="paypal-address" required placeholder="Full delivery address..." class="input-field" rows="3"></textarea>
                    </div>
                </div>
                
                <div id="paypal-button-container"></div>
            </div>
        </div>

        <!-- Registration Payment Modal -->
        <div id="registration-modal" class="modal hidden" onclick="if(event.target === this) closeRegistrationModal()">
            <div class="bg-white rounded-2xl p-10 max-w-2xl w-full mx-4 shadow-2xl max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-gray-900">Member Registration Payment</h2>
                    <button onclick="closeRegistrationModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </div>
                
                <div class="space-y-6 mb-8">
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Full Name *</label>
                        <input id="reg-name" required placeholder="Your full name" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Email *</label>
                        <input id="reg-email" type="email" required placeholder="your@email.com" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Phone Number *</label>
                        <input id="reg-phone" required placeholder="+27 XX XXX XXXX" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Registration Amount (ZAR) *</label>
                        <input id="reg-amount" type="number" required placeholder="Enter amount in Rands" class="input-field">
                        <p class="text-xs text-gray-500 mt-2">Minimum R180 (converted to USD at checkout)</p>
                        <div id="reg-conversion" class="mt-2 text-sm font-bold text-yellow-600"></div>
                    </div>
                </div>
                
                <div id="registration-paypal-button"></div>
            </div>
        </div>

        <!-- Ritual Payment Modal -->
        <div id="ritual-modal" class="modal hidden" onclick="if(event.target === this) closeRitualModal()">
            <div class="bg-white rounded-2xl p-10 max-w-4xl w-full mx-4 shadow-2xl max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-gray-900">Select Your Ritual</h2>
                    <button onclick="closeRitualModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Available Ritual Products</h3>
                    <div id="ritual-products-grid" class="grid md:grid-cols-3 gap-6"></div>
                </div>
                
                <div id="ritual-payment-section" class="hidden">
                    <div class="border-t-2 border-gray-200 pt-8 space-y-6">
                        <h3 class="text-xl font-bold text-gray-900">Payment Information</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Full Name *</label>
                                <input id="ritual-name" required placeholder="Your full name" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Email *</label>
                                <input id="ritual-email" type="email" required placeholder="your@email.com" class="input-field">
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Phone Number *</label>
                                <input id="ritual-phone" required placeholder="+27 XX XXX XXXX" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Payment Amount (ZAR) *</label>
                                <input id="ritual-amount" type="number" required placeholder="Enter amount to pay" class="input-field">
                                <p class="text-xs text-gray-500 mt-2">Full price: R<span id="ritual-full-price">0</span></p>
                                <div id="ritual-conversion" class="mt-2 text-sm font-bold text-yellow-600"></div>
                            </div>
                        </div>
                        
                        <div id="ritual-paypal-button"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact/Message Modal -->
        <div id="contact-modal" class="modal hidden" onclick="if(event.target === this) closeContactModal()">
            <div class="bg-white rounded-2xl p-10 max-w-2xl w-full mx-4 shadow-2xl max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-gray-900">Send Us a Message</h2>
                    <button onclick="closeContactModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Your Name *</label>
                        <input id="contact-name" required placeholder="Your full name" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Email *</label>
                        <input id="contact-email" type="email" required placeholder="your@email.com" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Phone Number *</label>
                        <input id="contact-phone" required placeholder="+27 XX XXX XXXX" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-3 text-gray-700 uppercase tracking-wide">Your Message *</label>
                        <textarea id="contact-message" required placeholder="Write your message here..." class="input-field" rows="6"></textarea>
                    </div>
                    
                    <button onclick="sendContactMessage()" class="btn-primary w-full py-4">
                        <i data-lucide="send" class="w-5 h-5 inline mr-2"></i>Send Message
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div id="admin-login-modal" class="modal hidden" onclick="if(event.target === this) closeAdminLogin()">
            <div class="bg-white rounded-2xl p-10 max-w-md w-full mx-4 shadow-2xl" onclick="event.stopPropagation()">
                <h2 class="text-3xl font-black text-gray-900 mb-6">Admin Access</h2>
                <input id="admin-password" type="password" placeholder="Enter admin password" class="input-field mb-6">
                <div class="flex gap-4">
                    <button onclick="closeAdminLogin()" class="flex-1 btn-secondary py-4">Cancel</button>
                    <button onclick="checkAdminPassword()" class="flex-1 btn-primary py-4">Login</button>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="modal hidden">
            <div class="bg-white rounded-2xl p-12 max-w-lg w-full mx-4 text-center shadow-2xl">
                <div class="w-24 h-24 rounded-full mx-auto mb-6 flex items-center justify-center bg-gradient-to-br from-yellow-500 to-yellow-600">
                    <i data-lucide="check-circle" class="w-14 h-14 text-white"></i>
                </div>
                <h2 class="text-4xl font-black text-gray-900 mb-4">Payment Successful!</h2>
                <p class="text-gray-600 mb-8 text-lg">
                    Your order will be processed within 24 hours. 
                    Check your email for confirmation and tracking details.
                </p>
                <button onclick="closeSuccessModal()" class="btn-primary w-full py-4 text-lg">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyDDMsvRTz9nPGDk8Ob_FPRc5Boov2FVt9w",
            authDomain: "egn-portal.firebaseapp.com",
            projectId: "egn-portal",
            storageBucket: "egn-portal.firebasestorage.app",
            messagingSenderId: "88252271549",
            appId: "1:88252271549:web:80aa211a420e205c1720d4",
            measurementId: "G-KYMBME9RDQ"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // ===== CURRENCY CONVERSION =====
        const ZAR_TO_USD = 0.055; // 1 ZAR = 0.055 USD
        
        function zarToUsd(zar) {
            return (zar * ZAR_TO_USD).toFixed(2);
        }
        
        // ===== DEFAULT PRODUCTS (IN ZAR) =====
        const DEFAULT_PRODUCTS = [
            {
                id: 'default-1',
                name: 'Illuminati PROTECTION Ritual Ring',
                price: 6500,
                category: 'Protection Items',
                description: 'This is protection ring that can save you from Accidents, Gunshots Danger and any bad situation set against you as the owner of the Illuminati BR protection ring.',
                details: 'Once you wear the ring after being fully built spiritually by instruction you get introduced to the world of fully protection against weapons, fights, enemies, and accidents.',
                instructions: 'For usage or instructions pay required amount for the ritual, we will call you and tell about the ring delivery and how to built it spiritually. We only give instructions after payments call 27810792898 for more information.',
                images: ['https://i.postimg.cc/rpxrWCfB/images-(14).jpg'],
                phone: '27810792898',
                isDefault: true
            },
            {
                id: 'default-2',
                name: 'Fame & Confidence ILLUMINATI BR Ritual Necklace',
                price: 5500,
                category: 'Ritual Kits',
                description: 'This is an ILLUMINATI BR Necklace built with Powerful black rituals mixed with human voice desires and invitation from ILLUMINATI WICCAN gods to grant fame and confidence.',
                details: 'This necklace is built with Black Rituals that makes people to instantly like your work or anything you do. People will see your work and love it and you will be favoured wherever you go.',
                instructions: 'For usage or instructions pay required amount for the ritual, we will call you and tell about the necklace delivery and how to built it spiritually. We only give instructions after payments call 27810792898 for more information.',
                images: ['https://i.postimg.cc/d1XjvmVr/s-l1200-(1).jpg'],
                phone: '27810792898',
                isDefault: true
            },
            {
                id: 'default-3',
                name: 'Personal WEALTH SUCCESS Ritual',
                price: 15000,
                category: 'rituals',
                description: 'This is the Ritual that can change your life and your situation mostly good for attracting wealth, commonly used around South Africa by most successful people.',
                details: 'This ritual does not take anything related to human sacrifices or family related issues. It only requires your voice and double black candles that will be delivered to you during the ritual performance.',
                instructions: 'For usage or instructions pay required amount for the ritual, we will call you and tell about the ritual delivery. We only give instructions after payments call 27810792898 for more information.',
                images: ['https://i.postimg.cc/BQzJxjw4/images-(20).jpg'],
                phone: '27810792898',
                isDefault: true
            },
            {
                id: 'default-4',
                name: 'Coin of Luck ILLUMINATI BR Ritual',
                price: 5500,
                category: 'Ritual Kits',
                description: 'This is a FULLY Ritual built Coin to attract good energy and remove bad energy on any person who carries the ILLUMINATED Coin from Black Rituals.',
                details: 'This coin turns you to be everyones favourite. It makes all chances to be on your side with pure LUCK BUILT by Black Rituals.',
                instructions: 'For usage or instructions pay required amount for the ritual, we will call you and tell about the coin delivery and how to built it spiritually. We only give instructions after payments call 27810792898 for more information.',
                images: ['https://i.postimg.cc/fyVZSZZN/images-(4).jpg'],
                phone: '27810792898',
                isDefault: true
            }
        ];

        // ===== DEFAULT TESTIMONIALS =====
        const DEFAULT_TESTIMONIALS = [
            {
                id: 'test-1',
                name: 'Nomsa Dlamini',
                title: 'Energy Healer',
                quote: 'The black sage bundle from Illuminati Black Rituals completely transformed my practice. The energy is authentic and powerful.',
                image_url: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&q=80',
                isDefault: true
            },
            {
                id: 'test-2',
                name: 'Thabo Maleka',
                title: 'Traditional Healer',
                quote: 'As a sangoma, I need genuine spiritual tools. Illuminati Black Rituals provides authentic products that carry real power.',
                image_url: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&q=80',
                isDefault: true
            },
            {
                id: 'test-3',
                name: 'Sarah van Rensburg',
                title: 'Spiritual Coach',
                quote: 'The full moon ritual kit is absolutely incredible! I have performed the ceremony three times and manifested everything I asked for.',
                image_url: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&q=80',
                isDefault: true
            },
            {
                id: 'test-4',
                name: 'Marcus Johnson',
                title: 'Yoga Instructor',
                quote: 'I use the dragon blood oil before every class to protect the space. Students always comment on how safe and peaceful the energy feels.',
                image_url: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&q=80',
                isDefault: true
            },
            {
                id: 'test-5',
                name: 'Zanele Khumalo',
                title: 'Meditation Teacher',
                quote: 'The ancestral communication candle helped me finally connect with my grandmother who passed. I felt her presence so strongly.',
                image_url: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&q=80',
                isDefault: true
            }
        ];
        
        // ===== APPLICATION STATE =====
        let AppState = {
            currentPage: 'home',
            selectedProduct: null,
            selectedRitualProduct: null,
            currentConversation: null,
            customerData: null,
            products: [],
            testimonials: [],
            orders: [],
            conversations: [],
            settings: {
                shop_email: "illuminatiblackrituals@gmail.com",
                shop_phone: "27810792898",
                footer_text: "© 2024 Illuminati Black Rituals - Premium Spiritual Products"
            },
            stats: {
                products: 0,
                customers: 0,
                orders: 0,
                revenue: 0
            }
        };
        
        // ===== INIT CHARTS =====
        let salesChart, categoryChart;
        
        function initCharts() {
            const salesCtx = document.getElementById('salesChart');
            const categoryCtx = document.getElementById('categoryChart');
            
            if (salesChart) salesChart.destroy();
            if (categoryChart) categoryChart.destroy();
            
            if (salesCtx) {
                const monthlyData = calculateMonthlyOrders();
                salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: monthlyData.labels,
                        datasets: [{
                            label: 'Orders',
                            data: monthlyData.data,
                            borderColor: '#d4af37',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#000', font: { weight: 'bold' } } }
                        },
                        scales: {
                            y: { ticks: { color: '#666' }, grid: { color: '#e5e7eb' } },
                            x: { ticks: { color: '#666' }, grid: { color: '#e5e7eb' } }
                        }
                    }
                });
            }
            
            if (categoryCtx) {
                const categoryData = calculateCategoryData();
                categoryChart = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categoryData.labels,
                        datasets: [{
                            data: categoryData.data,
                            backgroundColor: ['#d4af37', '#aa8b2e', '#8b7424', '#ffd700', '#b8860b', '#daa520']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#000', font: { weight: 'bold' } } }
                        }
                    }
                });
            }
        }
        
        function calculateMonthlyOrders() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const data = [0, 0, 0, 0, 0, 0];
            
            AppState.orders.forEach(order => {
                if (order.timestamp) {
                    const date = order.timestamp.toDate ? order.timestamp.toDate() : new Date(order.timestamp);
                    const month = date.getMonth();
                    if (month < 6) data[month]++;
                }
            });
            
            return { labels: months, data: data };
        }
        
        function calculateCategoryData() {
            const categories = {};
            AppState.products.forEach(p => {
                categories[p.category] = (categories[p.category] || 0) + 1;
            });
            return {
                labels: Object.keys(categories),
                data: Object.values(categories)
            };
        }
        
        // ===== FIREBASE STORAGE UPLOAD =====
        async function uploadImagesToStorage(files) {
            const uploadPromises = Array.from(files).map(async (file) => {
                const timestamp = Date.now();
                const filename = `products/${timestamp}_${file.name}`;
                const storageRef = storage.ref(filename);
                
                await storageRef.put(file);
                const url = await storageRef.getDownloadURL();
                return url;
            });
            
            return await Promise.all(uploadPromises);
        }
        
        async function uploadSingleImage(file) {
            const timestamp = Date.now();
            const filename = `testimonials/${timestamp}_${file.name}`;
            const storageRef = storage.ref(filename);
            
            await storageRef.put(file);
            return await storageRef.getDownloadURL();
        }
        
        // ===== FIREBASE FUNCTIONS =====
        async function loadProductsFromFirebase() {
            try {
                const snapshot = await db.collection('products').orderBy('created_at', 'desc').get();
                const firebaseProducts = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    isDefault: false
                }));
                
                AppState.products = [...DEFAULT_PRODUCTS, ...firebaseProducts];
                AppState.stats.products = AppState.products.length;
                updateStats();
                displayProducts();
                displayAdminProducts();
            } catch (error) {
                console.error('Error loading products:', error);
                AppState.products = DEFAULT_PRODUCTS;
                AppState.stats.products = DEFAULT_PRODUCTS.length;
                displayProducts();
            }
        }

        async function loadTestimonialsFromFirebase() {
            try {
                const snapshot = await db.collection('testimonials').orderBy('created_at', 'desc').get();
                const firebaseTestimonials = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    isDefault: false
                }));
                
                AppState.testimonials = [...DEFAULT_TESTIMONIALS, ...firebaseTestimonials];
                displayTestimonials();
                displayAdminTestimonials();
            } catch (error) {
                console.error('Error loading testimonials:', error);
                AppState.testimonials = DEFAULT_TESTIMONIALS;
                displayTestimonials();
            }
        }
        
        async function loadOrdersFromFirebase() {
            try {
                const snapshot = await db.collection('orders').orderBy('timestamp', 'desc').get();
                AppState.orders = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                const uniqueCustomers = new Set(AppState.orders.map(o => o.email)).size;
                const totalRevenue = AppState.orders
                    .filter(o => o.status === 'completed' || o.status === 'paid')
                    .reduce((sum, o) => sum + parseFloat(o.amount_zar || 0), 0);
                
                AppState.stats.customers = uniqueCustomers;
                AppState.stats.orders = AppState.orders.length;
                AppState.stats.revenue = totalRevenue;
                
                updateStats();
                displayOrders();
                
                if (salesChart || categoryChart) {
                    initCharts();
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        async function loadConversations() {
            try {
                const snapshot = await db.collection('messages').orderBy('timestamp', 'desc').get();
                const allMessages = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Group by email
                const grouped = {};
                allMessages.forEach(msg => {
                    const key = msg.email;
                    if (!grouped[key]) {
                        grouped[key] = {
                            email: msg.email,
                            name: msg.name,
                            phone: msg.phone,
                            messages: [],
                            lastMessage: msg.timestamp
                        };
                    }
                    grouped[key].messages.push(msg);
                });
                
                AppState.conversations = Object.values(grouped).sort((a, b) => 
                    (b.lastMessage?.toDate ? b.lastMessage.toDate() : new Date(b.lastMessage)) - 
                    (a.lastMessage?.toDate ? a.lastMessage.toDate() : new Date(a.lastMessage))
                );
                
                displayConversations();
            } catch (error) {
                console.error('Error loading conversations:', error);
            }
        }

        function displayConversations() {
            const list = document.getElementById('conversations-list');
            if (!list) return;
            
            if (AppState.conversations.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">No messages yet</p>';
                return;
            }
            
            list.innerHTML = AppState.conversations.map(conv => `
                <div onclick="openConversation('${conv.email}')" class="p-4 rounded-xl bg-gray-50 hover:bg-yellow-50 border-2 border-transparent hover:border-yellow-500 cursor-pointer transition">
                    <div class="font-bold text-gray-900">${conv.name}</div>
                    <div class="text-xs text-gray-600">${conv.email}</div>
                    <div class="text-xs text-gray-500 mt-1">${conv.messages.length} message(s)</div>
                </div>
            `).join('');
        }

        function openConversation(email) {
            const conv = AppState.conversations.find(c => c.email === email);
            if (!conv) return;
            
            AppState.currentConversation = conv;
            document.getElementById('no-chat-selected').classList.add('hidden');
            document.getElementById('chat-area').classList.remove('hidden');
            document.getElementById('chat-customer-name').textContent = conv.name;
            document.getElementById('chat-customer-email').textContent = conv.email;
            
            displayMessages(conv.messages);
        }

        function displayMessages(messages) {
            const container = document.getElementById('messages-container');
            container.innerHTML = messages.map(msg => `
                <div class="message-bubble ${msg.is_admin ? 'sent' : 'received'}">
                    <div class="text-sm">${msg.message}</div>
                    <div class="text-xs opacity-70 mt-1">${msg.timestamp ? new Date(msg.timestamp.toDate ? msg.timestamp.toDate() : msg.timestamp).toLocaleString() : ''}</div>
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        async function sendAdminMessage() {
            const input = document.getElementById('admin-message-input');
            const text = input.value.trim();
            if (!text || !AppState.currentConversation) return;
            
            try {
                await db.collection('messages').add({
                    email: AppState.currentConversation.email,
                    name: AppState.currentConversation.name,
                    phone: AppState.currentConversation.phone,
                    message: text,
                    is_admin: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                input.value = '';
                await loadConversations();
                openConversation(AppState.currentConversation.email);
                showToast('✅ Message sent!');
            } catch (error) {
                showToast('❌ Failed to send', 'error');
            }
        }

        async function addProduct() {
            const name = document.getElementById('new-product-name').value.trim();
            const price = parseFloat(document.getElementById('new-product-price').value);
            const category = document.getElementById('new-product-category').value;
            const description = document.getElementById('new-product-description').value.trim();
            const details = document.getElementById('new-product-details').value.trim();
            const instructions = document.getElementById('new-product-instructions').value.trim();
            const imageFiles = document.getElementById('new-product-images').files;
            const phone = document.getElementById('new-product-phone').value.trim();
            
            if (!name || !price || !description || !details || !instructions || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (imageFiles.length === 0) {
                showToast('Please upload at least one image', 'error');
                return;
            }
            
            const btn = document.getElementById('add-product-btn');
            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader" class="w-5 h-5 inline mr-2 animate-spin"></i>Uploading Images...';
            lucide.createIcons();
            
            try {
                const imageUrls = await uploadImagesToStorage(imageFiles);
                
                const productData = {
                    name, price, category, description, details, instructions, phone,
                    images: imageUrls,
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('products').add(productData);
                
                document.getElementById('new-product-name').value = '';
                document.getElementById('new-product-price').value = '';
                document.getElementById('new-product-description').value = '';
                document.getElementById('new-product-details').value = '';
                document.getElementById('new-product-instructions').value = '';
                document.getElementById('new-product-images').value = '';
                document.getElementById('new-product-phone').value = '';
                document.getElementById('image-preview').innerHTML = '';
                
                showToast('✅ Product added successfully!');
                await loadProductsFromFirebase();
            } catch (error) {
                console.error('Error adding product:', error);
                showToast('❌ Failed to add product', 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<i data-lucide="plus" class="w-6 h-6 inline mr-2"></i>Add Product to Store';
            lucide.createIcons();
        }
        
        document.getElementById('new-product-images').addEventListener('change', function(e) {
            const preview = document.getElementById('image-preview');
            preview.innerHTML = '';
            
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.className = 'w-20 h-20 object-cover rounded-lg border-2 border-gray-300';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        async function deleteProduct(id, isDefault) {
            if (isDefault) {
                showToast('❌ Cannot delete default products', 'error');
                return;
            }
            
            if (!confirm('Delete this product permanently?')) return;
            
            try {
                await db.collection('products').doc(id).delete();
                showToast('✅ Product deleted!');
                await loadProductsFromFirebase();
            } catch (error) {
                console.error('Error deleting product:', error);
                showToast('❌ Failed to delete', 'error');
            }
        }

        async function addTestimonial() {
            const name = document.getElementById('new-testimonial-name').value.trim();
            const title = document.getElementById('new-testimonial-title').value.trim();
            const quote = document.getElementById('new-testimonial-quote').value.trim();
            const imageFile = document.getElementById('new-testimonial-image').files[0];
            
            if (!name || !title || !quote) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            try {
                let imageUrl = 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&q=80';
                
                if (imageFile) {
                    imageUrl = await uploadSingleImage(imageFile);
                }
                
                const testimonialData = {
                    name, title, quote, image_url: imageUrl,
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('testimonials').add(testimonialData);
                
                document.getElementById('new-testimonial-name').value = '';
                document.getElementById('new-testimonial-title').value = '';
                document.getElementById('new-testimonial-quote').value = '';
                document.getElementById('new-testimonial-image').value = '';
                
                showToast('✅ Testimonial added!');
                await loadTestimonialsFromFirebase();
            } catch (error) {
                console.error('Error adding testimonial:', error);
                showToast('❌ Failed to add', 'error');
            }
        }

        async function deleteTestimonial(id, isDefault) {
            if (isDefault) {
                showToast('❌ Cannot delete default testimonials', 'error');
                return;
            }
            
            if (!confirm('Delete this testimonial?')) return;
            
            try {
                await db.collection('testimonials').doc(id).delete();
                showToast('✅ Testimonial deleted!');
                await loadTestimonialsFromFirebase();
            } catch (error) {
                console.error('Error deleting:', error);
                showToast('❌ Failed to delete', 'error');
            }
        }
        
        async function markOrderCompleted(orderId) {
            try {
                await db.collection('orders').doc(orderId).update({
                    status: 'completed',
                    completed_at: firebase.firestore.FieldValue.serverTimestamp()
                });
                showToast('✅ Order marked as completed!');
                await loadOrdersFromFirebase();
            } catch (error) {
                console.error('Error updating order:', error);
                showToast('❌ Failed to update order', 'error');
            }
        }

        function displayProducts() {
            const grid = document.getElementById('products-grid');
            if (!grid) return;
            
            grid.innerHTML = AppState.products.map(product => {
                const mainImage = product.images ? product.images[0] : product.image_url;
                return `
                    <div class="product-card">
                        <div class="relative h-72 overflow-hidden" onclick='showProductDetails(${JSON.stringify(product).replace(/'/g, "&#39;")})'>
                            <img src="${mainImage}" alt="${product.name}" 
                                 class="w-full h-full object-cover transition-transform duration-500">
                            <span class="badge absolute top-4 left-4">${product.category}</span>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2 leading-tight" onclick='showProductDetails(${JSON.stringify(product).replace(/'/g, "&#39;")})'>${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-4 leading-relaxed line-clamp-2">${product.description}</p>
                            
                            <div class="alert-box">
                                <i data-lucide="info" class="w-5 h-5 flex-shrink-0"></i>
                                <p class="text-xs">Pay to get full instructions & ritual items. Call after payment.</p>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4">
                                <span class="price-tag">R${product.price}</span>
                            </div>
                            
                            <button onclick='openPayPalCheckout(${JSON.stringify(product).replace(/'/g, "&#39;")})' class="btn-primary w-full mt-4">
                                <i data-lucide="shopping-cart" class="w-4 h-4 inline mr-2"></i>Buy Now
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function showProductDetails(product) {
            AppState.selectedProduct = product;
            const modal = document.getElementById('product-modal');
            const content = document.getElementById('product-modal-content');
            
            const images = product.images || [product.image_url];
            
            content.innerHTML = `
                <div class="p-8">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <img src="${images[0]}" id="main-product-image" alt="${product.name}" 
                                 class="w-full h-96 object-cover rounded-2xl mb-4">
                            ${images.length > 1 ? `
                                <div class="image-gallery">
                                    ${images.map((img, idx) => `
                                        <img src="${img}" onclick="document.getElementById('main-product-image').src='${img}'" 
                                             alt="View ${idx + 1}">
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="flex gap-4 mt-6">
                                <button onclick="openPayPalCheckout(${JSON.stringify(product).replace(/'/g, "&#39;")})" class="btn-primary flex-1 py-4">
                                    <i data-lucide="shopping-cart" class="w-5 h-5 inline mr-2"></i>Buy Now - R${product.price}
                                </button>
                                <button onclick="closeProductModal()" class="btn-secondary px-8">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                        <div class="overflow-y-auto max-h-[600px] pr-4">
                            <span class="badge mb-4">${product.category}</span>
                            <h2 class="text-4xl font-black text-gray-900 mb-4">${product.name}</h2>
                            <div class="price-tag mb-6">R${product.price}</div>
                            
                            ${product.phone ? `
                            <div class="mb-6 p-4 rounded-xl bg-yellow-50 border-2 border-yellow-500">
                                <div class="flex items-center gap-3 text-gray-900">
                                    <i data-lucide="phone" class="w-5 h-5 text-yellow-600"></i>
                                    <span class="font-bold">Contact: ${product.phone}</span>
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="alert-box mb-6">
                                <i data-lucide="lock" class="w-6 h-6"></i>
                                <div>
                                    <p class="font-bold mb-1">Full Instructions After Payment</p>
                                    <p class="text-xs">Complete your purchase to receive detailed ritual instructions via call.</p>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                        <i data-lucide="info" class="w-5 h-5 text-yellow-600"></i>
                                        Product Description
                                    </h3>
                                    <p class="text-gray-700 leading-relaxed">${product.details || product.description}</p>
                                </div>
                                
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-3 flex items-center gap-2">
                                        <i data-lucide="book-open" class="w-5 h-5 text-yellow-600"></i>
                                        Basic Usage Guide
                                    </h3>
                                    <p class="text-gray-700 leading-relaxed">${product.instructions}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
        }

        function displayAdminProducts() {
            const list = document.getElementById('admin-products-list');
            if (!list) return;
            
            list.innerHTML = AppState.products.length === 0 
                ? '<p class="text-gray-500 col-span-full text-center py-12 text-lg">No products yet.</p>'
                : AppState.products.map(p => {
                    const mainImage = p.images ? p.images[0] : p.image_url;
                    return `
                        <div class="stat-card p-6">
                            <img src="${mainImage}" class="w-full h-48 object-cover rounded-xl mb-4">
                            ${p.images && p.images.length > 1 ? `<p class="text-xs text-gray-500 mb-2">${p.images.length} images</p>` : ''}
                            <h4 class="font-bold text-gray-900 text-lg mb-2">${p.name}</h4>
                            <p class="text-yellow-600 font-bold text-xl mb-2">R${p.price}</p>
                            <span class="badge text-xs">${p.category}</span>
                            ${!p.isDefault ? `
                                <button onclick="deleteProduct('${p.id}', false)" class="w-full mt-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold transition">
                                    <i data-lucide="trash-2" class="w-4 h-4 inline mr-2"></i>Delete
                                </button>
                            ` : '<p class="text-xs text-gray-500 mt-4 text-center">Default Product</p>'}
                        </div>
                    `;
                }).join('');
            
            lucide.createIcons();
        }
        
        function displayOrders() {
            const list = document.getElementById('orders-list');
            if (!list) return;
            
            if (AppState.orders.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-12 text-lg">No orders yet.</p>';
                return;
            }
            
            list.innerHTML = AppState.orders.map(order => {
                const isCompleted = order.status === 'completed';
                const date = order.timestamp ? (order.timestamp.toDate ? order.timestamp.toDate() : new Date(order.timestamp)) : new Date();
                
                return `
                    <div class="order-card ${isCompleted ? 'completed' : ''}">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-lg font-bold text-gray-900 mb-1">${order.product_name || 'Product'}</h4>
                                <p class="text-sm text-gray-600">Order ID: ${order.id}</p>
                                <p class="text-xs text-gray-500">${date.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-yellow-600">R${parseFloat(order.amount_zar || 0).toFixed(2)}</div>
                                <div class="text-xs text-gray-500">($${parseFloat(order.amount_usd || 0).toFixed(2)} USD)</div>
                                <span class="inline-block px-3 py-1 rounded-full text-xs font-bold mt-2 ${
                                    isCompleted ? 'bg-green-100 text-green-800' : 
                                    order.status === 'paid' ? 'bg-blue-100 text-blue-800' : 
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${isCompleted ? 'COMPLETED' : order.status === 'paid' ? 'PAID' : 'PENDING'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4 text-sm">
                            <div>
                                <p class="text-gray-600 mb-1"><strong>Customer:</strong> ${order.name || 'N/A'}</p>
                                <p class="text-gray-600 mb-1"><strong>Email:</strong> ${order.email || 'N/A'}</p>
                                <p class="text-gray-600"><strong>Phone:</strong> ${order.phone || 'N/A'}</p>
                            </div>
                            <div>
                                <p class="text-gray-600 mb-1"><strong>City:</strong> ${order.city || 'N/A'}</p>
                                <p class="text-gray-600"><strong>Address:</strong> ${order.address || 'N/A'}</p>
                            </div>
                        </div>
                        
                        ${!isCompleted ? `
                            <button onclick="markOrderCompleted('${order.id}')" class="btn-primary w-full py-3">
                                <i data-lucide="check-square" class="w-4 h-4 inline mr-2"></i>Mark as Completed
                            </button>
                        ` : `
                            <div class="bg-green-50 border-2 border-green-500 rounded-xl p-4 text-center">
                                <i data-lucide="check-circle" class="w-6 h-6 inline mr-2 text-green-600"></i>
                                <span class="font-bold text-green-800">Order Fulfilled</span>
                            </div>
                        `}
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function displayTestimonials() {
            const grid = document.getElementById('testimonials-grid');
            if (!grid) return;
            
            grid.innerHTML = AppState.testimonials.map(t => `
                <div class="stat-card p-8">
                    <div class="flex items-center gap-4 mb-6">
                        <img src="${t.image_url}" alt="${t.name}" 
                             class="w-16 h-16 rounded-full object-cover border-2 border-yellow-500">
                        <div>
                            <div class="font-bold text-gray-900 text-lg">${t.name}</div>
                            <div class="text-yellow-600 text-sm font-semibold">${t.title}</div>
                        </div>
                    </div>
                    <p class="text-gray-700 italic leading-relaxed">"${t.quote}"</p>
                </div>
            `).join('');
        }

        function displayAdminTestimonials() {
            const list = document.getElementById('testimonials-admin-list');
            if (!list) return;
            
            const firebaseOnly = AppState.testimonials.filter(t => !t.isDefault);
            list.innerHTML = firebaseOnly.length === 0 
                ? '<p class="text-gray-500 text-center py-8">No custom testimonials yet.</p>'
                : firebaseOnly.map(t => `
                    <div class="stat-card p-4 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <img src="${t.image_url}" class="w-12 h-12 rounded-full object-cover">
                            <div>
                                <div class="font-bold text-gray-900">${t.name}</div>
                                <div class="text-gray-600 text-sm">${t.title}</div>
                            </div>
                        </div>
                        <button onclick="deleteTestimonial('${t.id}', false)" class="btn-secondary px-4 py-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `).join('');
            
            lucide.createIcons();
        }

        function updateStats() {
            document.getElementById('stat-products').textContent = AppState.stats.products;
            document.getElementById('stat-customers').textContent = AppState.stats.customers;
            document.getElementById('stat-orders').textContent = AppState.stats.orders;
            document.getElementById('stat-revenue').textContent = 'R' + AppState.stats.revenue.toLocaleString();
        }

        // ===== PAYPAL INTEGRATION =====
        function openPayPalCheckout(product) {
            AppState.selectedProduct = product;
            closeProductModal();
            
            const summary = document.getElementById('paypal-order-summary');
            const mainImage = product.images ? product.images[0] : product.image_url;
            const usdPrice = zarToUsd(product.price);
            
            summary.innerHTML = `
                <div class="flex gap-6 p-6 rounded-2xl bg-yellow-50 border-2 border-yellow-500">
                    <img src="${mainImage}" class="w-32 h-32 object-cover rounded-xl">
                    <div class="flex-1">
                        <h3 class="font-bold text-gray-900 text-2xl mb-2">${product.name}</h3>
                        <p class="text-gray-600 mb-3">${product.description}</p>
                        <div class="price-tag">R${product.price}</div>
                        <div class="text-sm text-gray-600 mt-2">PayPal Amount: <strong>$${usdPrice} USD</strong></div>
                    </div>
                </div>
            `;
            
            document.getElementById('paypal-modal').classList.remove('hidden');
            renderPayPalButton('paypal-button-container', usdPrice, product.price, 'product', product);
            lucide.createIcons();
        }

        function closePayPalModal() {
            document.getElementById('paypal-modal').classList.add('hidden');
            document.getElementById('paypal-button-container').innerHTML = '';
        }

        function openRegistrationModal() {
            document.getElementById('registration-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeRegistrationModal() {
            document.getElementById('registration-modal').classList.add('hidden');
            document.getElementById('registration-paypal-button').innerHTML = '';
        }

        function openRitualPaymentModal() {
            document.getElementById('ritual-modal').classList.remove('hidden');
            
            const grid = document.getElementById('ritual-products-grid');
            const ritualProducts = AppState.products.filter(p => 
                p.category === 'rituals' || 
                p.category === 'Ritual Kits' || 
                p.name.toLowerCase().includes('ritual')
            );
            
            grid.innerHTML = ritualProducts.map(p => {
                const mainImage = p.images ? p.images[0] : p.image_url;
                return `
                    <div class="ritual-option" onclick="selectRitualProduct(${JSON.stringify(p).replace(/'/g, "&#39;")})">
                        <img src="${mainImage}" class="w-full h-40 object-cover rounded-xl mb-4">
                        <h4 class="font-bold text-gray-900 mb-2">${p.name}</h4>
                        <div class="price-tag text-lg">R${p.price}</div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function closeRitualModal() {
            document.getElementById('ritual-modal').classList.add('hidden');
            document.getElementById('ritual-payment-section').classList.add('hidden');
            document.getElementById('ritual-paypal-button').innerHTML = '';
            AppState.selectedRitualProduct = null;
        }

        function selectRitualProduct(product) {
            AppState.selectedRitualProduct = product;
            document.getElementById('ritual-full-price').textContent = product.price;
            document.getElementById('ritual-payment-section').classList.remove('hidden');
            
            document.querySelectorAll('.ritual-option').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            lucide.createIcons();
        }

        function openContactModal() {
            document.getElementById('contact-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeContactModal() {
            document.getElementById('contact-modal').classList.add('hidden');
        }

        async function sendContactMessage() {
            const name = document.getElementById('contact-name').value.trim();
            const email = document.getElementById('contact-email').value.trim();
            const phone = document.getElementById('contact-phone').value.trim();
            const message = document.getElementById('contact-message').value.trim();
            
            if (!name || !email || !phone || !message) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            try {
                await db.collection('messages').add({
                    name, email, phone, message,
                    is_admin: false,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showToast('✅ Message sent successfully!');
                closeContactModal();
                
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-email').value = '';
                document.getElementById('contact-phone').value = '';
                document.getElementById('contact-message').value = '';
            } catch (error) {
                showToast('❌ Failed to send message', 'error');
            }
        }

        function renderPayPalButton(containerId, usdAmount, zarAmount, type, extraData = null) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            paypal.Buttons({
                style: {
                    layout: 'vertical',
                    color: 'black',
                    shape: 'rect',
                    label: 'pay',
                    height: 55
                },
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: usdAmount.toString(),
                                currency_code: 'USD'
                            },
                            description: extraData ? extraData.name : 'Payment'
                        }]
                    });
                },
                onApprove: async function(data, actions) {
                    return actions.order.capture().then(async function(details) {
                        let orderData = {
                            transaction_id: details.id,
                            amount_usd: usdAmount,
                            amount_zar: zarAmount,
                            status: 'paid',
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            type: type
                        };

                        if (type === 'product') {
                            orderData.name = document.getElementById('paypal-name').value;
                            orderData.email = document.getElementById('paypal-email').value;
                            orderData.phone = document.getElementById('paypal-phone').value;
                            orderData.city = document.getElementById('paypal-city').value;
                            orderData.address = document.getElementById('paypal-address').value;
                            orderData.product_name = extraData.name;
                            orderData.product_id = extraData.id;
                        } else if (type === 'registration') {
                            orderData.name = document.getElementById('reg-name').value;
                            orderData.email = document.getElementById('reg-email').value;
                            orderData.phone = document.getElementById('reg-phone').value;
                            orderData.product_name = 'Member Registration';
                        } else if (type === 'ritual') {
                            orderData.name = document.getElementById('ritual-name').value;
                            orderData.email = document.getElementById('ritual-email').value;
                            orderData.phone = document.getElementById('ritual-phone').value;
                            orderData.product_name = extraData.name;
                            orderData.product_id = extraData.id;
                            orderData.full_price_zar = extraData.price;
                        }

                        await db.collection('orders').add(orderData);
                        
                        closePayPalModal();
                        closeRegistrationModal();
                        closeRitualModal();
                        document.getElementById('success-modal').classList.remove('hidden');
                        lucide.createIcons();
                    });
                },
                onError: function(err) {
                    console.error('PayPal Error:', err);
                    showToast('Payment failed. Please try again.', 'error');
                }
            }).render('#' + containerId);
        }

        // Registration amount conversion
        document.getElementById('reg-amount').addEventListener('input', function() {
            const zarAmount = parseFloat(this.value);
            if (zarAmount >= 180) {
                const usdAmount = zarToUsd(zarAmount);
                document.getElementById('reg-conversion').textContent = `PayPal will charge: $${usdAmount} USD`;
                renderPayPalButton('registration-paypal-button', usdAmount, zarAmount, 'registration');
            } else {
                document.getElementById('reg-conversion').textContent = '';
                document.getElementById('registration-paypal-button').innerHTML = '';
            }
        });

        // Ritual amount conversion
        document.getElementById('ritual-amount').addEventListener('input', function() {
            const zarAmount = parseFloat(this.value);
            if (zarAmount > 0 && AppState.selectedRitualProduct) {
                const usdAmount = zarToUsd(zarAmount);
                document.getElementById('ritual-conversion').textContent = `PayPal will charge: $${usdAmount} USD`;
                renderPayPalButton('ritual-paypal-button', usdAmount, zarAmount, 'ritual', AppState.selectedRitualProduct);
            } else {
                document.getElementById('ritual-conversion').textContent = '';
                document.getElementById('ritual-paypal-button').innerHTML = '';
            }
        });

        // ===== UTILITY FUNCTIONS =====
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast' + (type === 'error' ? ' error' : '');
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function showPage(pageId) {
            document.querySelectorAll('#app-container > div').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId + '-page').classList.remove('hidden');
            AppState.currentPage = pageId;
            
            if (pageId === 'admin') {
                setTimeout(() => initCharts(), 100);
            }
            
            if (pageId === 'messages') {
                loadConversations();
            }
            
            lucide.createIcons();
        }

        function showAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-password').value = '';
        }

        async function checkAdminPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === 'VNAXXTTM') {
                closeAdminLogin();
                showPage('admin');
                showAdminTab('products');
                await loadProductsFromFirebase();
                await loadTestimonialsFromFirebase();
                await loadOrdersFromFirebase();
                initCharts();
            } else {
                showToast('❌ Invalid password', 'error');
            }
        }

        function showAdminTab(tabId) {
            document.querySelectorAll('.admin-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
            document.getElementById('admin-content-' + tabId).classList.remove('hidden');
            document.getElementById('admin-tab-' + tabId).classList.add('active');
            lucide.createIcons();
        }

        function saveSettings() {
            AppState.settings.shop_email = document.getElementById('shop-email').value;
            AppState.settings.shop_phone = document.getElementById('shop-phone').value;
            AppState.settings.footer_text = document.getElementById('footer-text').value;
            
            document.getElementById('footer-copyright').textContent = AppState.settings.footer_text;
            document.getElementById('footer-email').textContent = AppState.settings.shop_email;
            document.getElementById('footer-phone').textContent = AppState.settings.shop_phone;
            
            localStorage.setItem('shop_settings', JSON.stringify(AppState.settings));
            showToast('✅ Settings saved successfully!');
        }

        window.addEventListener('load', async function() {
            const savedSettings = localStorage.getItem('shop_settings');
            if (savedSettings) {
                AppState.settings = {...AppState.settings, ...JSON.parse(savedSettings)};
                document.getElementById('footer-copyright').textContent = AppState.settings.footer_text;
                document.getElementById('footer-email').textContent = AppState.settings.shop_email;
                document.getElementById('footer-phone').textContent = AppState.settings.shop_phone;
            }
            
            await loadProductsFromFirebase();
            await loadTestimonialsFromFirebase();
            await loadOrdersFromFirebase();
            lucide.createIcons();
        });

        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
            showPage('home');
        }
        
        lucide.createIcons();
    </script>
</body>
</html>
